<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>Space Engineers: Sources/VRage.Render/Animations/MyAnimationStateMachine.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Space Engineers
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_937900b87e0c7a5fa01190c395fb83f7.html">Sources</a></li><li class="navelem"><a class="el" href="dir_73e7221dbf0d5f04fb3fd3ef66bb45af.html">VRage.Render</a></li><li class="navelem"><a class="el" href="dir_217190236f62f80733f13c36665be2c1.html">Animations</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">MyAnimationStateMachine.cs</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_my_animation_state_machine_8cs.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">using</span> <a class="code" href="_my_gui_skin_definition_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a>;</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.<a class="code" href="namespace_system_1_1_collections.html">Collections</a>.<a class="code" href="namespace_system_1_1_collections_1_1_generic.html">Generic</a>;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_system.html">System</a>.Diagnostics;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_v_rage.html">VRage</a>.<a class="code" href="namespace_v_rage_1_1_generics.html">Generics</a>;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_v_rage.html">VRage</a>.<a class="code" href="namespace_v_rage_1_1_utils.html">Utils</a>;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> <a class="code" href="namespace_v_rage_math.html">VRageMath</a>;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">namespace </span><a class="code" href="namespace_v_rage_render.html">VRageRender</a>.Animations</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;{</div>
<div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html">   14</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html">MyAnimationStateMachine</a> : <a class="code" href="class_v_rage_1_1_generics_1_1_my_single_state_machine.html">MySingleStateMachine</a></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    {</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        <span class="comment">// Blending mode of the layer.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#aab7c7025acf5b2ffe48dbba0650c2305">   17</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">enum</span> <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#aab7c7025acf5b2ffe48dbba0650c2305">MyBlendingMode</a></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        {</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;            Replace, <span class="comment">// replace current bone transformations with our results</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;            Add      <span class="comment">// add our results to current bone transformations</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        }</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        <span class="comment">// Structure used for storing information necessary for blending between states.</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        <span class="keyword">private</span> <span class="keyword">struct </span>MyStateTransitionBlending</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;            <span class="keyword">public</span> <span class="keywordtype">double</span> TimeLeftInSeconds;      <span class="comment">// remaining time of blending in seconds</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;            <span class="keyword">public</span> <span class="keywordtype">double</span> InvTotalTime;  <span class="comment">// 1/(total time of transition blending)</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;            <span class="keyword">public</span> <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_node.html">MyAnimationStateMachineNode</a> SourceState; <span class="comment">// source state</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        }</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <span class="comment">// Animation update data for current update call.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#a4f9dafa5e143e5d2ffbebf7241ea134d">   32</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html">MyAnimationUpdateData</a> <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#a4f9dafa5e143e5d2ffbebf7241ea134d">CurrentUpdateData</a>;</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="comment">// Layer blending mode. Each layer can replace masked bones or can add transformations from this layer to them.</span></div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#ae64debab9aec0ca836180648a55e6307">   34</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#aab7c7025acf5b2ffe48dbba0650c2305">MyBlendingMode</a> Mode = <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#aab7c7025acf5b2ffe48dbba0650c2305">MyBlendingMode</a>.Replace;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="comment">// Layer bone mask - hashset string ids.</span></div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#ab0ef0f7a814fabd72b9084a21e161b76">   36</a></span>&#160;        <span class="keyword">public</span> readonly HashSet&lt;MyStringId&gt; BoneMaskStrIds = <span class="keyword">new</span> HashSet&lt;MyStringId&gt;();</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="comment">// Layer bone mask - fast array, length = count of character bones. True = layer affects this bone, false = opposite.</span></div>
<div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#abc082a2193ac5b3b20734709897abbe9">   38</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span>[] <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#abc082a2193ac5b3b20734709897abbe9">BoneMask</a>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <span class="comment">// List of states which are currently blended out.</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        <span class="keyword">private</span> readonly List&lt;MyStateTransitionBlending&gt; m_stateTransitionBlending;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="comment">// Visited tree nodes of current state - used for debugging.</span></div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#ad69b47475d78e7cd3cb425f55de62e05">   43</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">int</span>[] VisitedTreeNodesPath { <span class="keyword">get</span>; <span class="keyword">private</span> set; }</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="comment">// Visited tree nodes of current state - used for debugging.</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">int</span>[] m_lastVisitedTreeNodesPath;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="comment">// Default constructor.</span></div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#ac9db9ca5475e5880edd22b5c61f16b74">   48</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#ac9db9ca5475e5880edd22b5c61f16b74">MyAnimationStateMachine</a>()</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            VisitedTreeNodesPath = <span class="keyword">new</span> <span class="keywordtype">int</span>[64];</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;            m_lastVisitedTreeNodesPath = <span class="keyword">new</span> <span class="keywordtype">int</span>[64];</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            m_stateTransitionBlending = <span class="keyword">new</span> List&lt;MyStateTransitionBlending&gt;();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            base.OnStateChanged += AnimationStateChanged;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        }</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        <span class="comment">// Update state machine. That means:</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        <span class="comment">//   Change state if transition conditions are fulfilled.</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        <span class="comment">//   Update skeleton.</span></div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#a8de4e8200fd53315fac1c799c7e0e3ef">   59</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#a8de4e8200fd53315fac1c799c7e0e3ef">Update</a>(ref <a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html">MyAnimationUpdateData</a> data)</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            <span class="keywordflow">if</span> (data.CharacterBones == null)</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                <span class="keywordflow">return</span>; <span class="comment">// safety</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            CurrentUpdateData = data;                         <span class="comment">// local copy</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a7d82a4fb4f16581209df7c21f40af7af">VisitedTreeNodesCounter</a> = 0;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a82f041fe3d671a3de71c59b5b279e06c">VisitedTreeNodesPath</a> = m_lastVisitedTreeNodesPath;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a82f041fe3d671a3de71c59b5b279e06c">VisitedTreeNodesPath</a>[0] = 0;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="keywordflow">if</span> (BoneMask == null)                             <span class="comment">// rebuild bone mask array if not done yet</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                RebuildBoneMask();</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            data.LayerBoneMask = CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a2e24b6a560866fd9bf0202996f3d9b8d">LayerBoneMask</a> = BoneMask;       <span class="comment">// pass bone mask array to all subnodes and result</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            Debug.Assert(data.LayerBoneMask != null);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="comment">// setting animation finished flag</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;            <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_node.html">MyAnimationStateMachineNode</a> currentAnimationNode = CurrentNode as <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_node.html">MyAnimationStateMachineNode</a>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            <span class="keywordflow">if</span> (currentAnimationNode != null &amp;&amp; currentAnimationNode.<a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_node.html#aea976cfae588e40b61ccad8f5bf4128d">RootAnimationNode</a> != null)</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            {</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                <span class="keywordtype">float</span> finishedPercent = currentAnimationNode.<a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_node.html#aea976cfae588e40b61ccad8f5bf4128d">RootAnimationNode</a>.<a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_tree_node.html#a3af60e04fc853409064188ece3f05740">GetLocalTimeNormalized</a>();</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                data.Controller.Variables.SetValue(MyAnimationVariableStorageHints.StrIdAnimationFinished, finishedPercent);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            }</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                data.Controller.Variables.SetValue(MyAnimationVariableStorageHints.StrIdAnimationFinished, 0);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            base.Update();</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="keywordtype">int</span>[] swapVisitedTreeNodesPath = VisitedTreeNodesPath;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            VisitedTreeNodesPath = m_lastVisitedTreeNodesPath;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            m_lastVisitedTreeNodesPath = swapVisitedTreeNodesPath;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a82f041fe3d671a3de71c59b5b279e06c">VisitedTreeNodesPath</a> = null;     <span class="comment">// disconnect our array</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="comment">// blended transitions</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            <span class="comment">//    - from most recent to oldest</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="comment">//    - please preserve order of blending for three or more states</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            <span class="comment">//      when CurrentState changes</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            <span class="keywordtype">float</span> weightMultiplier = 1.0f;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_stateTransitionBlending.Count; i++)</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                MyStateTransitionBlending stateTransitionBlending = m_stateTransitionBlending[i];</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                <span class="keywordtype">float</span> localWeight = (float)(stateTransitionBlending.TimeLeftInSeconds * stateTransitionBlending.InvTotalTime); <span class="comment">// 1 to 0 over time</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                weightMultiplier *= localWeight;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="comment">// update nodes that we are just leaving</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                <span class="keywordflow">if</span> (weightMultiplier &gt; 0)</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                    var lastResult = CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a7cfc0e24660ddd1c0bfcdd22f690edd1">BonesResult</a>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                    CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a7cfc0e24660ddd1c0bfcdd22f690edd1">BonesResult</a> = null;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    stateTransitionBlending.SourceState.OnUpdate(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                    <span class="keywordflow">if</span> (lastResult != null &amp;&amp; CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a7cfc0e24660ddd1c0bfcdd22f690edd1">BonesResult</a> != null)</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                    {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; lastResult.Count; j++)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                            <span class="keywordflow">if</span> (data.LayerBoneMask[j])</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                            {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                <span class="comment">// these nodes lose their weight, it goes from 1 to 0</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                                <span class="comment">// we need to blend them to last result (current node or another node that we are leaving)</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                                <span class="keywordtype">float</span> w = ComputeEaseInEaseOut(<a class="code" href="namespace_math_helper.html">MathHelper</a>.Clamp(weightMultiplier, 0, 1));</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                                CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a7cfc0e24660ddd1c0bfcdd22f690edd1">BonesResult</a>[j].Rotation = <a class="code" href="namespace_quaternion.html">Quaternion</a>.Slerp(lastResult[j].Rotation,</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                                    CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a7cfc0e24660ddd1c0bfcdd22f690edd1">BonesResult</a>[j].Rotation, w);</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                                CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a7cfc0e24660ddd1c0bfcdd22f690edd1">BonesResult</a>[j].Translation = <a class="code" href="namespace_vector3.html">Vector3</a>.Lerp(lastResult[j].Translation,</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                                    CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a7cfc0e24660ddd1c0bfcdd22f690edd1">BonesResult</a>[j].Translation, w);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                            }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                        <span class="comment">// give back last result (free list of bones), we dont need it anymore</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                        data.Controller.ResultBonesPool.Free(lastResult);</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                <span class="comment">// update, decrease remaining time</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                stateTransitionBlending.TimeLeftInSeconds -= data.DeltaTimeInSeconds;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                m_stateTransitionBlending[i] = stateTransitionBlending;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                <span class="keywordflow">if</span> (stateTransitionBlending.TimeLeftInSeconds &lt;= 0 || weightMultiplier &lt;= 0)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                    <span class="comment">// skip older blended states and mark them for deletion, because their (global) weight is now zero </span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = i + 1; j &lt; m_stateTransitionBlending.Count; j++)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                        var temp = m_stateTransitionBlending[j];</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                        temp.TimeLeftInSeconds = 0;  <span class="comment">// </span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                        m_stateTransitionBlending[j] = temp;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                    }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                    <span class="keywordflow">break</span>; </div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            m_stateTransitionBlending.RemoveAll(s =&gt; s.TimeLeftInSeconds &lt;= 0.0);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            data.BonesResult = CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a7cfc0e24660ddd1c0bfcdd22f690edd1">BonesResult</a>; <span class="comment">// local copy contains resulting list of bones</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">float</span> ComputeEaseInEaseOut(<span class="keywordtype">float</span> t)</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keywordflow">return</span> t * t * (3.0f - 2.0f * t);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="comment">// Rebuild bone mask array.</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">void</span> RebuildBoneMask()</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="keywordflow">if</span> (CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a6e9d484dc9906916ae5c705515ea0b41">CharacterBones</a> == null)</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            BoneMask = <span class="keyword">new</span> <span class="keywordtype">bool</span>[CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a6e9d484dc9906916ae5c705515ea0b41">CharacterBones</a>.Length];</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            <span class="keywordflow">if</span> (BoneMaskStrIds.Count == 0) <span class="comment">// no mask =&gt; all bones by default.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a6e9d484dc9906916ae5c705515ea0b41">CharacterBones</a>.Length; i++)</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                    BoneMask[i] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">else</span> <span class="comment">// mask defined =&gt; affect only bones named in BoneMaskStrIds</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a6e9d484dc9906916ae5c705515ea0b41">CharacterBones</a>.Length; i++)</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                    <a class="code" href="struct_v_rage_1_1_utils_1_1_my_string_id.html">MyStringId</a> charBoneStrId = <a class="code" href="struct_v_rage_1_1_utils_1_1_my_string_id.html">MyStringId</a>.<a class="code" href="struct_v_rage_1_1_utils_1_1_my_string_id.html#adbc09c4a5f76f8677a62165232887d16">TryGet</a>(CurrentUpdateData.<a class="code" href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a6e9d484dc9906916ae5c705515ea0b41">CharacterBones</a>[i].<a class="code" href="class_v_rage_render_1_1_animations_1_1_my_character_bone.html#a596aacc96b74e517e8786dc8fb08be02">Name</a>);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                    <span class="keywordflow">if</span> (charBoneStrId != <a class="code" href="struct_v_rage_1_1_utils_1_1_my_string_id.html">MyStringId</a>.<a class="code" href="struct_v_rage_1_1_utils_1_1_my_string_id.html#aa0fd18a58c066e26e654601d223ec94c">NullOrEmpty</a> &amp;&amp; BoneMaskStrIds.Contains(charBoneStrId))</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                        BoneMask[i] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                }</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="comment">// Implementation of ToString - for better debugging.</span></div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#a49835b9716a991fff2e30f995cfa6fdd">  175</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">string</span> <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#a49835b9716a991fff2e30f995cfa6fdd">ToString</a>()</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="keywordflow">return</span> String.Format(<span class="stringliteral">&quot;MyAnimationStateMachine, Name=&#39;{0}&#39;, Mode=&#39;{1}&#39;&quot;</span>, Name, Mode);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="comment">// Event handling - animation state changed. </span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">// We need to capture that because:</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="comment">//   1: state can be changed over time.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="comment">//   2: synchronization of states</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">void</span> AnimationStateChanged(<a class="code" href="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start.html">MyStateMachineTransitionWithStart</a> transitionWithStart)</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            var animationTransition = transitionWithStart.<a class="code" href="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start.html#a71ade8269bcd4faa8d85502e147cbe99">Transition</a> as <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_transition.html">MyAnimationStateMachineTransition</a>;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;            <span class="keywordflow">if</span> (animationTransition == null)</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            var animationSourceNode = transitionWithStart.<a class="code" href="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start.html#af0882b95b440abef4e4b780e2c8c0ebe">StartNode</a> as <a class="code" href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_node.html">MyAnimationStateMachineNode</a>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            var animationTargetNode = animationTransition.TargetNode as MyAnimationStateMachineNode;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">if</span> (animationSourceNode != null)</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                <span class="comment">// synchronization</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                <span class="keywordflow">if</span> (animationTargetNode != null)</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                    <span class="keywordtype">bool</span> targetAnimationStillPlaying = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                    <span class="keywordflow">foreach</span> (var blending <span class="keywordflow">in</span> m_stateTransitionBlending)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                    {</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                        <span class="keywordflow">if</span> (blending.SourceState == animationTargetNode)</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                        {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                            targetAnimationStillPlaying = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                        }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                    }</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                    <span class="comment">// synchronization options... use them only if target animation is not playing already </span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                    <span class="keywordflow">switch</span> (animationTransition.Sync)</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                    {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="namespace_v_rage_render_1_1_animations.html#ad4c49f3b8e10c881798a95f191d05104">MyAnimationTransitionSyncType</a>.Restart:</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                            <span class="keywordflow">if</span> (animationTargetNode.RootAnimationNode != null)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                            {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                animationTargetNode.RootAnimationNode.SetLocalTimeNormalized(0);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                            }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="namespace_v_rage_render_1_1_animations.html#ad4c49f3b8e10c881798a95f191d05104">MyAnimationTransitionSyncType</a>.Synchronize:</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                            <span class="keywordflow">if</span> (!targetAnimationStillPlaying &amp;&amp; animationSourceNode.RootAnimationNode != null &amp;&amp; animationTargetNode.RootAnimationNode != null)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                            {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                <span class="keywordtype">float</span> normalizedTimeInSource = animationSourceNode.RootAnimationNode.GetLocalTimeNormalized();</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                animationTargetNode.RootAnimationNode.SetLocalTimeNormalized(normalizedTimeInSource);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                            }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="namespace_v_rage_render_1_1_animations.html#ad4c49f3b8e10c881798a95f191d05104">MyAnimationTransitionSyncType</a>.NoSynchonization:</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                            <span class="comment">// do nothing</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                            <a class="code" href="namespace_sandbox_1_1_game_1_1_gui.html#a85590df7a7e0f84aafc9c190d8b4699eaa603905470e2a5b8c13e96b579ef0dba">Debug</a>.Fail(<span class="stringliteral">&quot;Unknown synchronization option.&quot;</span>);</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                    }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                <span class="comment">// transition over time</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <span class="keywordflow">if</span> ((animationTransition.TransitionTimeInSec &gt; 0.0 || transitionWithStart.<a class="code" href="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start.html#a71ade8269bcd4faa8d85502e147cbe99">Transition</a>.<a class="code" href="class_v_rage_1_1_generics_1_1_my_state_machine_transition.html#ae6be3e6e9ada1d583cf1a679f3c6de9c">TargetNode</a>.<a class="code" href="class_v_rage_1_1_generics_1_1_my_state_machine_node.html#a6922a384bee6db40eb30233c02d3e212">PassThrough</a>)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                    &amp;&amp; !transitionWithStart.<a class="code" href="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start.html#af0882b95b440abef4e4b780e2c8c0ebe">StartNode</a>.<a class="code" href="class_v_rage_1_1_generics_1_1_my_state_machine_node.html#a6922a384bee6db40eb30233c02d3e212">PassThrough</a>)</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                    MyStateTransitionBlending stateTransitionBlending = <span class="keyword">new</span> MyStateTransitionBlending <span class="comment">// struct</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                    {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                        SourceState = animationSourceNode,</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                        TimeLeftInSeconds = animationTransition.TransitionTimeInSec,</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                        InvTotalTime = 1.0/animationTransition.TransitionTimeInSec</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    };</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    <span class="keywordflow">if</span> (!stateTransitionBlending.InvTotalTime.IsValid())</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                        stateTransitionBlending.InvTotalTime = 1.0f;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                    m_stateTransitionBlending.Insert(0, stateTransitionBlending);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                    <span class="keywordflow">if</span> (transitionWithStart.<a class="code" href="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start.html#af0882b95b440abef4e4b780e2c8c0ebe">StartNode</a>.<a class="code" href="class_v_rage_1_1_generics_1_1_my_state_machine_node.html#a6922a384bee6db40eb30233c02d3e212">PassThrough</a> &amp;&amp; m_stateTransitionBlending.Count &gt; 0)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                        <span class="comment">// node1 -&gt; pass -&gt; node2, take maximum transition time</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                        MyStateTransitionBlending stateTransitionBlending = m_stateTransitionBlending[0]; <span class="comment">// struct</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                        stateTransitionBlending.TimeLeftInSeconds = <a class="code" href="namespace_math.html">Math</a>.Max(animationTransition.TransitionTimeInSec, m_stateTransitionBlending[0].TimeLeftInSeconds);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                        stateTransitionBlending.InvTotalTime = 1.0 / stateTransitionBlending.TimeLeftInSeconds;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                        <span class="keywordflow">if</span> (!stateTransitionBlending.InvTotalTime.IsValid())</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                            stateTransitionBlending.InvTotalTime = 1.0f;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                        m_stateTransitionBlending[0] = stateTransitionBlending;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                    }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (animationTransition.TransitionTimeInSec &lt;= MyMathConstants.EPSILON)</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                    {</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                        m_stateTransitionBlending.Clear();</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                            <span class="comment">// instantly play new animation, forget about all blending stuff!</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                    }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    }</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_html_a4f9dafa5e143e5d2ffbebf7241ea134d"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#a4f9dafa5e143e5d2ffbebf7241ea134d">VRageRender.Animations.MyAnimationStateMachine.CurrentUpdateData</a></div><div class="ttdeci">MyAnimationUpdateData CurrentUpdateData</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_state_machine_8cs_source.html#l00032">MyAnimationStateMachine.cs:32</a></div></div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_html_a8de4e8200fd53315fac1c799c7e0e3ef"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#a8de4e8200fd53315fac1c799c7e0e3ef">VRageRender.Animations.MyAnimationStateMachine.Update</a></div><div class="ttdeci">void Update(ref MyAnimationUpdateData data)</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_state_machine_8cs_source.html#l00059">MyAnimationStateMachine.cs:59</a></div></div>
<div class="ttc" id="namespace_v_rage_1_1_generics_html"><div class="ttname"><a href="namespace_v_rage_1_1_generics.html">VRage.Generics</a></div><div class="ttdef"><b>Definition:</b> <a href="_i_my_condition_8cs_source.html#l00006">IMyCondition.cs:6</a></div></div>
<div class="ttc" id="namespace_system_1_1_collections_1_1_generic_html"><div class="ttname"><a href="namespace_system_1_1_collections_1_1_generic.html">System.Collections.Generic</a></div><div class="ttdef"><b>Definition:</b> <a href="_dictionary_extensions_8cs_source.html#l00007">DictionaryExtensions.cs:7</a></div></div>
<div class="ttc" id="namespace_math_helper_html"><div class="ttname"><a href="namespace_math_helper.html">MathHelper</a></div></div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_html"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html">VRageRender.Animations.MyAnimationStateMachine</a></div><div class="ttdoc">Animation state machine selects the animation to match current state. When it finds valid transition ...</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_state_machine_8cs_source.html#l00014">MyAnimationStateMachine.cs:14</a></div></div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_node_html"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_node.html">VRageRender.Animations.MyAnimationStateMachineNode</a></div><div class="ttdoc">Animation state machine node is a representation of one state inside MyAnimationStateMachine. </div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_state_machine_node_8cs_source.html#l00010">MyAnimationStateMachineNode.cs:10</a></div></div>
<div class="ttc" id="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start_html"><div class="ttname"><a href="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start.html">VRage.Generics.MyStateMachineTransitionWithStart</a></div><div class="ttdoc">Pair holding transition and its starting node. </div><div class="ttdef"><b>Definition:</b> <a href="_my_state_machine_transition_8cs_source.html#l00052">MyStateMachineTransition.cs:52</a></div></div>
<div class="ttc" id="namespace_quaternion_html"><div class="ttname"><a href="namespace_quaternion.html">Quaternion</a></div></div>
<div class="ttc" id="namespace_system_html"><div class="ttname"><a href="namespace_system.html">System</a></div></div>
<div class="ttc" id="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data_html_a82f041fe3d671a3de71c59b5b279e06c"><div class="ttname"><a href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a82f041fe3d671a3de71c59b5b279e06c">VRageRender.Animations.MyAnimationUpdateData.VisitedTreeNodesPath</a></div><div class="ttdeci">int[] VisitedTreeNodesPath</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_update_data_8cs_source.html#l00034">MyAnimationUpdateData.cs:34</a></div></div>
<div class="ttc" id="namespace_sandbox_1_1_game_1_1_gui_html_a85590df7a7e0f84aafc9c190d8b4699eaa603905470e2a5b8c13e96b579ef0dba"><div class="ttname"><a href="namespace_sandbox_1_1_game_1_1_gui.html#a85590df7a7e0f84aafc9c190d8b4699eaa603905470e2a5b8c13e96b579ef0dba">Sandbox.Game.Gui.Debug</a></div></div>
<div class="ttc" id="_my_gui_skin_definition_8cs_html_a81a223a02c34d82b47199f08308847f2"><div class="ttname"><a href="_my_gui_skin_definition_8cs.html#a81a223a02c34d82b47199f08308847f2">System</a></div><div class="ttdeci">﻿using System</div><div class="ttdef"><b>Definition:</b> <a href="_my_gui_skin_definition_8cs_source.html#l00001">MyGuiSkinDefinition.cs:1</a></div></div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_transition_html"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_transition.html">VRageRender.Animations.MyAnimationStateMachineTransition</a></div><div class="ttdoc">Description of transition to another state (MyAnimationStateMachineNode) in the state machine (MyAnim...</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_state_machine_transition_8cs_source.html#l00017">MyAnimationStateMachineTransition.cs:17</a></div></div>
<div class="ttc" id="struct_v_rage_1_1_utils_1_1_my_string_id_html"><div class="ttname"><a href="struct_v_rage_1_1_utils_1_1_my_string_id.html">VRage.Utils.MyStringId</a></div><div class="ttdoc">Generates unique IDs for strings. When used as key for hash tables (Dictionary or HashSet) always pas...</div><div class="ttdef"><b>Definition:</b> <a href="_my_string_id_8cs_source.html#l00017">MyStringId.cs:17</a></div></div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_html_ac9db9ca5475e5880edd22b5c61f16b74"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#ac9db9ca5475e5880edd22b5c61f16b74">VRageRender.Animations.MyAnimationStateMachine.MyAnimationStateMachine</a></div><div class="ttdeci">MyAnimationStateMachine()</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_state_machine_8cs_source.html#l00048">MyAnimationStateMachine.cs:48</a></div></div>
<div class="ttc" id="class_v_rage_1_1_generics_1_1_my_state_machine_node_html_a6922a384bee6db40eb30233c02d3e212"><div class="ttname"><a href="class_v_rage_1_1_generics_1_1_my_state_machine_node.html#a6922a384bee6db40eb30233c02d3e212">VRage.Generics.MyStateMachineNode.PassThrough</a></div><div class="ttdeci">bool PassThrough</div><div class="ttdef"><b>Definition:</b> <a href="_my_state_machine_node_8cs_source.html#l00027">MyStateMachineNode.cs:27</a></div></div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_html_aab7c7025acf5b2ffe48dbba0650c2305"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#aab7c7025acf5b2ffe48dbba0650c2305">VRageRender.Animations.MyAnimationStateMachine.MyBlendingMode</a></div><div class="ttdeci">MyBlendingMode</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_state_machine_8cs_source.html#l00017">MyAnimationStateMachine.cs:17</a></div></div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_character_bone_html_a596aacc96b74e517e8786dc8fb08be02"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_character_bone.html#a596aacc96b74e517e8786dc8fb08be02">VRageRender.Animations.MyCharacterBone.Name</a></div><div class="ttdeci">string Name</div><div class="ttdoc">The bone name </div><div class="ttdef"><b>Definition:</b> <a href="_my_character_bone_8cs_source.html#l00067">MyCharacterBone.cs:67</a></div></div>
<div class="ttc" id="namespace_v_rage_1_1_utils_html"><div class="ttname"><a href="namespace_v_rage_1_1_utils.html">VRage.Utils</a></div><div class="ttdef"><b>Definition:</b> <a href="_my5_bit_encoding_8cs_source.html#l00006">My5BitEncoding.cs:6</a></div></div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_html_abc082a2193ac5b3b20734709897abbe9"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#abc082a2193ac5b3b20734709897abbe9">VRageRender.Animations.MyAnimationStateMachine.BoneMask</a></div><div class="ttdeci">bool[] BoneMask</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_state_machine_8cs_source.html#l00038">MyAnimationStateMachine.cs:38</a></div></div>
<div class="ttc" id="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data_html_a2e24b6a560866fd9bf0202996f3d9b8d"><div class="ttname"><a href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a2e24b6a560866fd9bf0202996f3d9b8d">VRageRender.Animations.MyAnimationUpdateData.LayerBoneMask</a></div><div class="ttdeci">bool[] LayerBoneMask</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_update_data_8cs_source.html#l00026">MyAnimationUpdateData.cs:26</a></div></div>
<div class="ttc" id="class_v_rage_1_1_generics_1_1_my_single_state_machine_html"><div class="ttname"><a href="class_v_rage_1_1_generics_1_1_my_single_state_machine.html">VRage.Generics.MySingleStateMachine</a></div><div class="ttdoc">Implementation of generic state machine. Inherit from this class to create your own state machine...</div><div class="ttdef"><b>Definition:</b> <a href="_my_single_state_machine_8cs_source.html#l00007">MySingleStateMachine.cs:7</a></div></div>
<div class="ttc" id="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start_html_a71ade8269bcd4faa8d85502e147cbe99"><div class="ttname"><a href="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start.html#a71ade8269bcd4faa8d85502e147cbe99">VRage.Generics.MyStateMachineTransitionWithStart.Transition</a></div><div class="ttdeci">MyStateMachineTransition Transition</div><div class="ttdef"><b>Definition:</b> <a href="_my_state_machine_transition_8cs_source.html#l00055">MyStateMachineTransition.cs:55</a></div></div>
<div class="ttc" id="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data_html_a7d82a4fb4f16581209df7c21f40af7af"><div class="ttname"><a href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a7d82a4fb4f16581209df7c21f40af7af">VRageRender.Animations.MyAnimationUpdateData.VisitedTreeNodesCounter</a></div><div class="ttdeci">int VisitedTreeNodesCounter</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_update_data_8cs_source.html#l00038">MyAnimationUpdateData.cs:38</a></div></div>
<div class="ttc" id="namespace_math_html"><div class="ttname"><a href="namespace_math.html">Math</a></div></div>
<div class="ttc" id="struct_v_rage_1_1_utils_1_1_my_string_id_html_aa0fd18a58c066e26e654601d223ec94c"><div class="ttname"><a href="struct_v_rage_1_1_utils_1_1_my_string_id.html#aa0fd18a58c066e26e654601d223ec94c">VRage.Utils.MyStringId.NullOrEmpty</a></div><div class="ttdeci">static readonly MyStringId NullOrEmpty</div><div class="ttdef"><b>Definition:</b> <a href="_my_string_id_8cs_source.html#l00019">MyStringId.cs:19</a></div></div>
<div class="ttc" id="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data_html"><div class="ttname"><a href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html">VRageRender.Animations.MyAnimationUpdateData</a></div><div class="ttdoc">Helper structure passed as an parameter during computation of current pose. </div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_update_data_8cs_source.html#l00008">MyAnimationUpdateData.cs:8</a></div></div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_node_html_aea976cfae588e40b61ccad8f5bf4128d"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_node.html#aea976cfae588e40b61ccad8f5bf4128d">VRageRender.Animations.MyAnimationStateMachineNode.RootAnimationNode</a></div><div class="ttdeci">MyAnimationTreeNode RootAnimationNode</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_state_machine_node_8cs_source.html#l00016">MyAnimationStateMachineNode.cs:16</a></div></div>
<div class="ttc" id="namespace_v_rage_math_html"><div class="ttname"><a href="namespace_v_rage_math.html">VRageMath</a></div><div class="ttdef"><b>Definition:</b> <a href="_base27_directions_8cs_source.html#l00007">Base27Directions.cs:7</a></div></div>
<div class="ttc" id="namespace_system_1_1_collections_html"><div class="ttname"><a href="namespace_system_1_1_collections.html">System.Collections</a></div></div>
<div class="ttc" id="namespace_v_rage_render_html"><div class="ttname"><a href="namespace_v_rage_render.html">VRageRender</a></div></div>
<div class="ttc" id="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data_html_a6e9d484dc9906916ae5c705515ea0b41"><div class="ttname"><a href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a6e9d484dc9906916ae5c705515ea0b41">VRageRender.Animations.MyAnimationUpdateData.CharacterBones</a></div><div class="ttdeci">MyCharacterBone[] CharacterBones</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_update_data_8cs_source.html#l00022">MyAnimationUpdateData.cs:22</a></div></div>
<div class="ttc" id="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data_html_a7cfc0e24660ddd1c0bfcdd22f690edd1"><div class="ttname"><a href="struct_v_rage_render_1_1_animations_1_1_my_animation_update_data.html#a7cfc0e24660ddd1c0bfcdd22f690edd1">VRageRender.Animations.MyAnimationUpdateData.BonesResult</a></div><div class="ttdeci">List&lt; MyAnimationClip.BoneState &gt; BonesResult</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_update_data_8cs_source.html#l00030">MyAnimationUpdateData.cs:30</a></div></div>
<div class="ttc" id="namespace_v_rage_html"><div class="ttname"><a href="namespace_v_rage.html">VRage</a></div></div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_animation_tree_node_html_a3af60e04fc853409064188ece3f05740"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_animation_tree_node.html#a3af60e04fc853409064188ece3f05740">VRageRender.Animations.MyAnimationTreeNode.GetLocalTimeNormalized</a></div><div class="ttdeci">abstract float GetLocalTimeNormalized()</div></div>
<div class="ttc" id="struct_v_rage_1_1_utils_1_1_my_string_id_html_adbc09c4a5f76f8677a62165232887d16"><div class="ttname"><a href="struct_v_rage_1_1_utils_1_1_my_string_id.html#adbc09c4a5f76f8677a62165232887d16">VRage.Utils.MyStringId.TryGet</a></div><div class="ttdeci">static bool TryGet(string str, out MyStringId id)</div><div class="ttdef"><b>Definition:</b> <a href="_my_string_id_8cs_source.html#l00136">MyStringId.cs:136</a></div></div>
<div class="ttc" id="namespace_vector3_html"><div class="ttname"><a href="namespace_vector3.html">Vector3</a></div></div>
<div class="ttc" id="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start_html_af0882b95b440abef4e4b780e2c8c0ebe"><div class="ttname"><a href="struct_v_rage_1_1_generics_1_1_my_state_machine_transition_with_start.html#af0882b95b440abef4e4b780e2c8c0ebe">VRage.Generics.MyStateMachineTransitionWithStart.StartNode</a></div><div class="ttdeci">MyStateMachineNode StartNode</div><div class="ttdef"><b>Definition:</b> <a href="_my_state_machine_transition_8cs_source.html#l00054">MyStateMachineTransition.cs:54</a></div></div>
<div class="ttc" id="class_v_rage_1_1_generics_1_1_my_state_machine_transition_html_ae6be3e6e9ada1d583cf1a679f3c6de9c"><div class="ttname"><a href="class_v_rage_1_1_generics_1_1_my_state_machine_transition.html#ae6be3e6e9ada1d583cf1a679f3c6de9c">VRage.Generics.MyStateMachineTransition.TargetNode</a></div><div class="ttdeci">MyStateMachineNode TargetNode</div><div class="ttdef"><b>Definition:</b> <a href="_my_state_machine_transition_8cs_source.html#l00015">MyStateMachineTransition.cs:15</a></div></div>
<div class="ttc" id="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine_html_a49835b9716a991fff2e30f995cfa6fdd"><div class="ttname"><a href="class_v_rage_render_1_1_animations_1_1_my_animation_state_machine.html#a49835b9716a991fff2e30f995cfa6fdd">VRageRender.Animations.MyAnimationStateMachine.ToString</a></div><div class="ttdeci">override string ToString()</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_state_machine_8cs_source.html#l00175">MyAnimationStateMachine.cs:175</a></div></div>
<div class="ttc" id="namespace_v_rage_render_1_1_animations_html_ad4c49f3b8e10c881798a95f191d05104"><div class="ttname"><a href="namespace_v_rage_render_1_1_animations.html#ad4c49f3b8e10c881798a95f191d05104">VRageRender.Animations.MyAnimationTransitionSyncType</a></div><div class="ttdeci">MyAnimationTransitionSyncType</div><div class="ttdef"><b>Definition:</b> <a href="_my_animation_state_machine_transition_8cs_source.html#l00007">MyAnimationStateMachineTransition.cs:7</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Jan 23 2017 01:17:04 for Space Engineers by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
